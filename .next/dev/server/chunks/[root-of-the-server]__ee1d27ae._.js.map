{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/wearebrain/Desktop/Manglar%20Media/adv_builder/xevio-adv-builder/app/api/history/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server'\nimport { createClient } from '@supabase/supabase-js'\n\nconst ITEMS_PER_PAGE = 5\n\nexport async function GET(request: Request) {\n  try {\n    const { searchParams } = new URL(request.url)\n    const userId = searchParams.get('userId')\n    const offset = parseInt(searchParams.get('offset') || '0', 10)\n\n    if (!userId) {\n      return NextResponse.json({ error: 'User ID is required' }, { status: 400 })\n    }\n\n    const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!\n    const supabaseKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\n    const supabase = createClient(supabaseUrl, supabaseKey)\n\n    // Fetch completed campaigns for this user\n    const { data: campaigns, error, count } = await supabase\n      .from('campaigns')\n      .select('id, doc_name, niche, country, campaign_type, created_at, generated_content', { count: 'exact' })\n      .eq('user_id', userId)\n      .eq('status', 'completed')\n      .order('created_at', { ascending: false })\n      .range(offset, offset + ITEMS_PER_PAGE - 1)\n\n    if (error) {\n      console.error('Supabase Error:', error)\n      return NextResponse.json({ error: 'Failed to fetch history' }, { status: 500 })\n    }\n\n    // Parse and format the campaigns\n    const formattedCampaigns = (campaigns || []).map((campaign) => ({\n      id: campaign.id,\n      title: parseProductName(campaign.doc_name),\n      campaignType: campaign.campaign_type,\n      niche: campaign.niche,\n      country: campaign.country,\n      createdAt: formatDate(campaign.created_at),\n      docUrl: campaign.generated_content,\n    }))\n\n    return NextResponse.json({\n      campaigns: formattedCampaigns,\n      total: count || 0,\n      hasMore: (offset + ITEMS_PER_PAGE) < (count || 0),\n    })\n\n  } catch (error) {\n    console.error('API Error:', error)\n    return NextResponse.json({ error: 'Internal Server Error' }, { status: 500 })\n  }\n}\n\n/**\n * Parse the product name from doc_name\n * Input: \"ECOM - Hair Growth Solution - US - 07.01.2026\"\n * Output: \"Hair Growth Solution\"\n */\nfunction parseProductName(docName: string | null): string {\n  if (!docName) return 'Untitled Campaign'\n  \n  const parts = docName.split(' - ')\n  \n  // If we have the expected format (TYPE - PRODUCT - COUNTRY - DATE)\n  // Return the second part (product name)\n  if (parts.length >= 2) {\n    return parts[1].trim()\n  }\n  \n  // Fallback: return the full name\n  return docName\n}\n\n/**\n * Format date to readable string\n * Input: \"2026-01-07T14:32:00Z\"\n * Output: \"Jan 7, 2026 - 14:32\"\n */\nfunction formatDate(dateString: string | null): string {\n  if (!dateString) return 'Unknown date'\n  \n  const date = new Date(dateString)\n  \n  const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']\n  const month = months[date.getMonth()]\n  const day = date.getDate()\n  const year = date.getFullYear()\n  const hours = date.getHours().toString().padStart(2, '0')\n  const minutes = date.getMinutes().toString().padStart(2, '0')\n  \n  return `${month} ${day}, ${year} - ${hours}:${minutes}`\n}\n\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,MAAM,iBAAiB;AAEhB,eAAe,IAAI,OAAgB;IACxC,IAAI;QACF,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,SAAS,aAAa,GAAG,CAAC;QAChC,MAAM,SAAS,SAAS,aAAa,GAAG,CAAC,aAAa,KAAK;QAE3D,IAAI,CAAC,QAAQ;YACX,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAsB,GAAG;gBAAE,QAAQ;YAAI;QAC3E;QAEA,MAAM;QACN,MAAM;QACN,MAAM,WAAW,IAAA,gMAAY,EAAC,aAAa;QAE3C,0CAA0C;QAC1C,MAAM,EAAE,MAAM,SAAS,EAAE,KAAK,EAAE,KAAK,EAAE,GAAG,MAAM,SAC7C,IAAI,CAAC,aACL,MAAM,CAAC,8EAA8E;YAAE,OAAO;QAAQ,GACtG,EAAE,CAAC,WAAW,QACd,EAAE,CAAC,UAAU,aACb,KAAK,CAAC,cAAc;YAAE,WAAW;QAAM,GACvC,KAAK,CAAC,QAAQ,SAAS,iBAAiB;QAE3C,IAAI,OAAO;YACT,QAAQ,KAAK,CAAC,mBAAmB;YACjC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA0B,GAAG;gBAAE,QAAQ;YAAI;QAC/E;QAEA,iCAAiC;QACjC,MAAM,qBAAqB,CAAC,aAAa,EAAE,EAAE,GAAG,CAAC,CAAC,WAAa,CAAC;gBAC9D,IAAI,SAAS,EAAE;gBACf,OAAO,iBAAiB,SAAS,QAAQ;gBACzC,cAAc,SAAS,aAAa;gBACpC,OAAO,SAAS,KAAK;gBACrB,SAAS,SAAS,OAAO;gBACzB,WAAW,WAAW,SAAS,UAAU;gBACzC,QAAQ,SAAS,iBAAiB;YACpC,CAAC;QAED,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,WAAW;YACX,OAAO,SAAS;YAChB,SAAS,AAAC,SAAS,iBAAkB,CAAC,SAAS,CAAC;QAClD;IAEF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,cAAc;QAC5B,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC7E;AACF;AAEA;;;;CAIC,GACD,SAAS,iBAAiB,OAAsB;IAC9C,IAAI,CAAC,SAAS,OAAO;IAErB,MAAM,QAAQ,QAAQ,KAAK,CAAC;IAE5B,mEAAmE;IACnE,wCAAwC;IACxC,IAAI,MAAM,MAAM,IAAI,GAAG;QACrB,OAAO,KAAK,CAAC,EAAE,CAAC,IAAI;IACtB;IAEA,iCAAiC;IACjC,OAAO;AACT;AAEA;;;;CAIC,GACD,SAAS,WAAW,UAAyB;IAC3C,IAAI,CAAC,YAAY,OAAO;IAExB,MAAM,OAAO,IAAI,KAAK;IAEtB,MAAM,SAAS;QAAC;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;KAAM;IACnG,MAAM,QAAQ,MAAM,CAAC,KAAK,QAAQ,GAAG;IACrC,MAAM,MAAM,KAAK,OAAO;IACxB,MAAM,OAAO,KAAK,WAAW;IAC7B,MAAM,QAAQ,KAAK,QAAQ,GAAG,QAAQ,GAAG,QAAQ,CAAC,GAAG;IACrD,MAAM,UAAU,KAAK,UAAU,GAAG,QAAQ,GAAG,QAAQ,CAAC,GAAG;IAEzD,OAAO,GAAG,MAAM,CAAC,EAAE,IAAI,EAAE,EAAE,KAAK,GAAG,EAAE,MAAM,CAAC,EAAE,SAAS;AACzD"}}]
}